<%- include('../partials/adminHeader.ejs')-%>

<div class="container tm-mt-big tm-mb-big">
    <div class="row">
      <div class="col-xl-9 col-lg-10 col-md-12 col-sm-12 mx-auto">
        <div class="tm-bg-primary-dark tm-block tm-block-h-auto">
          <div class="row">
            <div class="col-12">
              <h2 class="tm-block-title d-inline-block">Edit Product</h2>
            </div>
          </div>
          <div class="row tm-edit-product-row">
            <div class="col-xl-6 col-lg-6 col-md-12">
              <form action="/admin/editproduct?id=<%=products._id%>" method="post" enctype="multipart/form-data">
                <div class="form-group mb-3">
                  <label
                    for="name"
                    >Product Name
                  </label>
                  <input value="<%=products.name%>" type="text" name="Name" class="form-control" required>

                </div>
                <div class="form-group mb-3">
                  <label
                    for="description"
                    >Description</label
                  >
                  <textarea                    
                    type="text" name="Description" class="form-control"
                    rows="5"
                    required
                  ><%=products.description%></textarea>
                </div>
                <div class="form-group mb-3">
                  <label
                    for="category"
                    >Category</label
                  >
                  <select name="category"
                      class="custom-select tm-select-accounts" 
                      id="category" 
                    >
                    <option name="category"><%=products.category%></option><% if(category.length > 0){%>
                        <% for (let i = 0; i < category.length; i++) {%>
                      <option name="category"><%=category[i].categoryname%></option>
                      <%}}else{%>
                        <option value="3">Category Not found</option>
                       <%}%>
                    </select>
                </div>
                <div class="row">
                    <div class="form-group mb-3 col-xs-12 col-sm-6">
                        <label
                          for="expire_date"
                          >Price 
                        </label>
                        <input pattern="[^\s@<>]+" value="<%=products.price%>" type="text" name="Price" class="form-control" required>
                      </div>
                      <div class="form-group mb-3 col-xs-12 col-sm-6">
                        <label
                          for="stock"
                          >Units In Stock
                        </label>
                        <input
                          id="stock"
                          name="stock"
                          type="text"
                          value="<%=products.stock%>"
                          class="form-control validate"
                        />
                      </div>
                </div>
                
            </div>
            <div class="col-xl-6 col-lg-6 col-md-12 mx-auto mb-4">
              <!-- <div class="tm-product-img-edit mx-auto">
                <% if(products.image.length>0){%>
                  <% products.image.forEach((img)=>{%>  
                    <div class="image-container">
                      <img src="/images/product/<%= img.path %>" alt="" class="img-fluid d-block mx-auto">
                      <button class="delete-image" data-image-id="<%= img._id %>"><i class="fa fa-trash"></i></button>
                    </div>
                <%  }) %>
               <% } %> -->
               <div class="tm-product-img-edit mx-auto">
                <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                  <ol class="carousel-indicators">
                    <% products.image.forEach((img, index) => {%>
                    <li data-target="#carouselExampleIndicators" data-slide-to="<%=index%>" <% if (index === 0) { %>class="active"<% } %>></li>
                    <%})%>
                  </ol>
                  <div class="carousel-inner">
                    <% products.image.forEach((img, index) => {%>
                    <div class="image-container carousel-item <% if (index === 0) { %>active<% } %>">
                      <img src="/images/product/<%= img.path %>" alt="" class="d-block w-100">
                      <a href="/admin/deleteimage?index=<%=index%>&productId=<%=products.id%>" type="button" class="btn btn-danger btn-sm delete-image"><i class="fas fa-trash-alt"></i></a>
                    </div>
                    <%})%>

                  </div>
                  <!-- <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                  </a> -->
                  <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                  </a>
                </div>
                <div class="custom-file mt-3 mb-3">
                  <input id="fileInput" name="file" multiple type="file" id="formFile" style="display:none;" />
                  <input
                    type="button"
                    class="btn btn-primary btn-block mx-auto"
                    value="CHANGE IMAGE NOW"
                    onclick="document.getElementById('fileInput').click();"
                  />
                </div>
              </div>
              
                
              </div>
              
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-primary btn-block text-uppercase">Update Now</button>
            </div>
          </form>
          </div>
        </div>
      </div>
    </div>
  </div>

<%- include('../partials/adminFooter.ejs')-%>

<script>

//   $(document).on('click', '.delete-image', function() {
//   let imageId = $(this).data('image-id');
//   let container = $(this).closest('.image-container');
//   console.log(container);
  
//   $.ajax({
//     url: '/admin/deleteimage?id=' + imageId,
//     method: 'DELETE',
//     success: function(response) {
//       if (response.success) {
//         container.remove();
//       } else {
//         alert('Failed to delete image');
//       }
//     },
//     error: function() {
//       alert('Failed to delete image');
//     }
//   });
// });

</script>